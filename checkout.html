<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Checkout</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #F8F8F8;
      margin: 0;
      padding: 0;
    }
    .checkout-container {
      display: flex;
      gap: 32px;
      max-width: 1200px;
      margin: 40px auto;
    }
    .main-section {
      flex: 2;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
      padding: 32px;
    }
    .summary-section {
      flex: 1;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
      padding: 32px;
      height: fit-content;
    }
    .section-title {
      font-size: 1.4em;
      font-weight: bold;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .product-item {
      display: flex;
      gap: 24px;
      align-items: flex-start;
      margin-bottom: 24px;
      border-bottom: 1px solid #ececec;
      padding-bottom: 16px;
    }
    .product-image {
      width: 100px;
      height: 100px;
      object-fit: contain;
      border-radius: 6px;
      background: #eee;
    }
    .product-details {
      flex: 1;
    }
    .product-title {
      font-weight: bold;
      font-size: 1.1em;
      margin: 5px 0;
    }
    .remove-btn, .qty-btn {
      background: #fff;
      border: 1px solid #E53935;
      color: #E53935;
      padding: 6px 12px;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      margin-right: 6px;
      transition: all 0.15s;
    }
    .remove-btn:hover, .qty-btn:hover {
      background: #E53935;
      color: #fff;
    }
    .qty-btn {
      border: 1px solid #888;
      color: #444;
    }
    .qty-btn:hover {
      background: #eee;
      color: #000;
    }
    .continue-btn {
      background: #112557;
      color: #FFD600;
      margin-bottom: 10px;
    }
    .continue-btn:hover {
      filter: brightness(0.9);
    }
    .continue-btn:active {
      transform: scale(0.97);
    }
  </style>
</head>
<body>
  <div id="header"></div>
  <div class="checkout-container">
    <div class="main-section">
      <div class="section-title">
        ðŸ›’ PRODUTO E SERVIÃ‡O
        <button class="remove-all-btn" id="btn-limpar">REMOVER TODOS OS PRODUTOS</button>
      </div>
      <div id="produtos-lista"></div>
    </div>
    <div class="summary-section">
      <div class="resume-title">ðŸ“„ RESUMO</div>
      <div class="row">
        <span>Valor dos Produtos:</span>
        <span id="valorProdutos">R$ 0,00</span>
      </div>
      <div class="row" style="color:#555;">
        <span>Total a prazo:</span>
        <span id="totalPrazo">R$ 0,00</span>
      </div>
      <div style="color:#888; font-size:0.95em; margin-bottom:12px;" id="parcelasRow"></div>
      <div class="highlight" id="pixBox" style="display:none;">
        Valor Ã  vista no <span style="color:#00821E;"><b>PIX:</b></span>
        <span style="font-size:1.1em;" id="valorPix">R$ 0,00</span>
        <span style="font-size:0.9em; color:#00821E;" id="economize"></span>
      </div>
      <button class="continue-btn" onclick="finalizarCompra()">FINALIZAR COMPRA</button>
      <button class="back-btn" onclick="window.location='index.html'">VOLTAR</button>
    </div>
  </div>
  <div id="footer"></div>
  <script>
    fetch('header.html').then(res => res.text()).then(data => document.getElementById('header').innerHTML = data);
    fetch('footer.html').then(res => res.text()).then(data => document.getElementById('footer').innerHTML = data);

    const carrinho = JSON.parse(localStorage.getItem('carrinhoGranSafety')) || [];
    const lista = document.getElementById('produtos-lista');
    const btnLimpar = document.getElementById('btn-limpar');
    let total = 0;

    function renderCarrinho() {
      lista.innerHTML = '';
      total = 0;

      if (carrinho.length === 0) {
        lista.innerHTML = `<div class="empty-cart">Seu carrinho estÃ¡ vazio.</div>`;
        btnLimpar.style.display = 'none';
        atualizarResumo();
        return;
      } else {
        btnLimpar.style.display = '';
      }

      carrinho.forEach((item, index) => {
        total += item.total;
        const div = document.createElement('div');
        div.className = 'product-item';
        div.innerHTML = `
          <img src="${item.imagem || 'https://via.placeholder.com/100'}" class="product-image">
          <div class="product-details">
            <div class="product-title">${item.nome}</div>
            <div>PreÃ§o unitÃ¡rio: R$ ${item.precoUnit.toFixed(2).replace('.', ',')}</div>
            <div>Total: R$ ${item.total.toFixed(2).replace('.', ',')}</div>
            <div style="margin-top: 6px;">
              <button class="qty-btn" onclick="alterarQtd(${index}, -1)">âˆ’</button>
              <span style="margin: 0 8px;">${item.qtd}</span>
              <button class="qty-btn" onclick="alterarQtd(${index}, 1)">+</button>
            </div>
            <button class="remove-btn" onclick="removerItem(${index})">REMOVER</button>
          </div>
        `;
        lista.appendChild(div);
      });

      atualizarResumo();
    }

    function alterarQtd(index, delta) {
      carrinho[index].qtd += delta;
      if (carrinho[index].qtd <= 0) carrinho.splice(index, 1);
      else carrinho[index].total = carrinho[index].qtd * carrinho[index].precoUnit;
      localStorage.setItem('carrinhoGranSafety', JSON.stringify(carrinho));
      renderCarrinho();
    }

    function removerItem(index) {
      carrinho.splice(index, 1);
      localStorage.setItem('carrinhoGranSafety', JSON.stringify(carrinho));
      renderCarrinho();
    }

    function atualizarResumo() {
      document.getElementById('valorProdutos').textContent = formatar(total);
      document.getElementById('totalPrazo').textContent = formatar(total);
      document.getElementById('parcelasRow').innerHTML = `(em atÃ© <b>10x</b> de <b>${formatar(total/10)}</b> sem juros)`;
      if (total > 0) {
        let totalPix = total * 0.93;
        let economia = total - totalPix;
        document.getElementById('pixBox').style.display = '';
        document.getElementById('valorPix').textContent = formatar(totalPix);
        document.getElementById('economize').textContent = `(Economize: ${formatar(economia)})`;
      } else {
        document.getElementById('pixBox').style.display = 'none';
      }
    }

    function formatar(valor) {
      return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    btnLimpar.onclick = function () {
      localStorage.removeItem('carrinhoGranSafety');
      location.reload();
    };

    function finalizarCompra() {
      alert("Compra finalizada! Em breve entraremos em contato.");
      localStorage.removeItem('carrinhoGranSafety');
      location.href = "index.html";
    }

    renderCarrinho();
  </script>
</body>
</html>
